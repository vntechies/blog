---
title: Progressive Web Apps - VNTechies cho native platforms
tags: ['javascript', 'pwa']
date: '2022-08-13'
cover: /static/images/assets/XAf4YIj5fzjFXASz.jpg
layout: PostSimple
images: ['/static/images/ogps/pwa.png']
summary: 'Giá»›i thiá»‡u vá» Progressive Web App vÃ  Ã¡p dá»¥ng vá»›i VNTechies Dev Blog. CÃ¡ch Ä‘á»ƒ Ä‘áº¡t ğŸ’¯ Ä‘iá»ƒm performance trÃªn Lighthouse audit â¤ï¸â€ğŸ”¥'
---

<TOCInline toc={props.toc} asDisclosure />

![PWA](/static/images/ogps/pwa.png)

## Progressive web apps lÃ  gÃ¬?

[Theo google](https://developers.google.com/web/progressive-web-apps/), progressive web apps lÃ  nhá»¯ng á»©ng dá»¥ng web giÃºp ngÆ°á»i dÃ¹ng cÃ³ nhá»¯ng tráº£i nghiá»‡m sau:

- [Tin cáº­y](https://developers.google.com/web/progressive-web-apps/checklist): á»¨ng dá»¥ng cháº¡y ngay sau khi khá»Ÿi Ä‘á»™ng báº¥t ká»ƒ tráº¡ng thÃ¡i káº¿t ná»‘i máº¡ng cá»§a thiáº¿t bá»‹. Má»™t service nhá» hoáº¡t Ä‘á»™ng nhÆ° má»™t proxy phÃ­a client vÃ  bá»™ nhá»› cache sáº½ giÃºp á»©ng dá»¥ng trá»Ÿ nÃªn tin cáº­y, ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t cá»© lÃºc nÃ o, khÃ´ng phá»¥ thuá»™c vÃ o Internet.
- [Nhanh](https://developers.google.com/web/fundamentals/performance/why-performance-matters/) **53%** ngÆ°á»i dÃ¹ng sáº½ khÃ´ng truy cáº­p site náº¿u thá»i gian load quÃ¡ **3s** vÃ  khi trang Ä‘Æ°á»£c load, ngÆ°á»i dÃ¹ng muá»‘n cÃ³ má»™t á»©ng dá»¥ng cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c ngay.
- [Gáº¯n káº¿t](https://developers.google.com/web/fundamentals/web-app-manifest/) NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ cÃ i Ä‘áº·t app trÃªn home screen vÃ  sá»­ dá»¥ng á»Ÿ cháº¿ Ä‘á»™ fullscreen, thÃ´ng qua viá»‡c sá»­ dá»¥ng web manifest. CÃ³ há»— trá»£ [push notification](https://developers.google.com/web/fundamentals/push-notifications/) vá»›i cÃ¡c thiáº¿t bá»‹ di Ä‘á»™ng (chÆ°a Ä‘Æ°á»£c há»— trá»£ trÃªn iOS ğŸ¤”)

MÃ¬nh váº«n chÆ°a bao giá» háº¿t báº¥t ngá» vá»›i kháº£ nÄƒng sÃ¡ng táº¡o cá»§a Steve Jobs.
Táº¡i WWDC2007 cÃ¡ch Ä‘Ã¢y **15 nÄƒm**, Ã´ng Ä‘Ã£ giá»›i thiá»‡u vá» má»™t Ã½ tÆ°á»Ÿng (cÃ³ thá»ƒ coi lÃ  Ä‘áº§u tiÃªn) vá» PWA, web developers cÃ³ thá»ƒ láº­p trÃ¬nh á»©ng dá»¥ng iOS trÃªn ná»n safari.
CÃ³ Ä‘iá»u cÃ¡c developers cá»§a Apple cÃ³ váº» cháº­m cháº¡p hÆ¡n nhá»¯ng ngÆ°á»i Ä‘á»“ng nghiá»‡p táº¡i Google, [Safari tá»¥t háº­u hÆ¡n so vá»›i Chrome ](https://m.phillydevshop.com/apples-refusal-to-support-progressive-web-apps-is-a-serious-detriment-to-future-of-the-web-e81b2be29676)
vÃ  Google vá»›i cÃ´ng nghá»‡ PWA Ä‘Ã£ buá»™c Apple pháº£i cháº¥p nháº­n trong 2 báº£n cáº­p nháº­t cho macOS vÃ  iOS cá»§a mÃ¬nh.

## PWA hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?

![How it work?](/static/images/assets/pwa.png)

PWA sáº½ váº«n lÃ  má»™t web app bÃ¬nh thÆ°á»ng bá»• sung thÃªm file manifest vÃ  service worker.

- Manifest: JSON file chá»©a config cá»§a PWA, Ä‘áº§y Ä‘á»§ thÃ´ng tin Ä‘á»ƒ cÃ³ thá»ƒ cÃ i Ä‘áº·t trÃªn cÃ¡c native platforms:
  - short_name
  - icons
  - view mode
  - url cá»§a PWA,...
- Service worker: LÃ m viá»‡c nhÆ° má»™t proxy, khi user dÃ¹ng web app thÃ¬ service worker sáº½ Ä‘Ã³ng vai trÃ² Ä‘á»©ng á»Ÿ giá»¯a ngÆ°á»i dÃ¹ng vÃ  web apps, chá»‹u trÃ¡ch nhiá»‡m cho viá»‡c quáº£n lÃ½ cache, láº¥y tÃ i nguyÃªn tá»« network â†’ web app cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng offline Ä‘Æ°á»£c.

## Táº¡i sao nÃªn biáº¿n web app thÃ nh PWA?

**User engage facts**

- Websites:
  - **53%** ngÆ°á»i dÃ¹ng sáº½ tá»« bá» viá»‡c truy cáº­p má»™t website load quÃ¡ 3s
  - **1/2** ngÆ°á»i muá»‘n trang web load dÆ°á»›i **2s**
  - **3/4** á»©ng dá»¥ng web máº¥t hÆ¡n **10s** Ä‘á»ƒ load
- Native app:
  - Engage tá»‘t hÆ¡n nhá» push notification vÃ  home screen icon
  - Performance trÃªn native platform nhanh hÆ¡n vÃ  sá»­ dá»¥ng ngay Ä‘Æ°á»£c má»—i khi khá»Ÿi Ä‘á»™ng.
- PWA solutions:
  - Cáº£i thiá»‡n performance cá»§a web app
  - CÃ³ thá»ƒ cÃ i Ä‘áº·t nhÆ° native app
  - Push notification

**User reach facts**

![Vá»›i má»—i cÃ´ng Ä‘oáº¡n cÃ i Ä‘áº·t á»©ng dá»¥ng, báº¡n máº¥t Ä‘i 20% sá»‘ lÆ°á»£ng ngÆ°á»i dÃ¹ng](/static/images/assets/7lJM86DwyjzofGPF.png)

- Websites: Web browser lÃ m Ä‘Æ°á»£c nhiá»u thá»© hÆ¡n má»™t native app, nhanh, gá»n hÆ¡n.
- Native app: Báº¡n cáº§n bao nhiÃªu cÃ´ng Ä‘oáº¡n tá»« lÃºc biáº¿t Ä‘áº¿n app, cÃ i, cáº¥p permission...?

â†’ Káº¿t luáº­n

- Ordinary web apps ã€€**high** user reach, _low_ user engage
- Native Appsâ€Šâ†’ ã€€*low* user reach, **high** user engage
- PWAâ€Šâ†’ **high** user reach, **high** user engage

![Capabilities vs. reach of platform-specific apps, web apps, and progressive web apps.](https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/1DKtUFjXLJbiiruKA9P1.svg)

## TÃ¬nh hÃ¬nh tháº¿ giá»›i

![CÃ¡c á»©ng dá»¥ng PWA](/static/images/assets/oWnCYcQ2cM04mjmF.jpg)

- Chrome, Opera, Firefox, vÃ  Microsoft Edge Ä‘Ã£ há»— trá»£ PWA, Samsung internet browser cÅ©ng trong danh sÃ¡ch â†’ vá»›i cÃ¡c thiáº¿t bá»‹ android, PWA hoáº¡t Ä‘á»™ng tá»‘t vÃ  cÃ³ Ä‘áº§y Ä‘á»§ cÃ¡c chá»©c nÄƒng. Safari Ä‘Ã£ há»— trá»£ service workers vÃ  má»™t vÃ i tÃ­nh nÄƒng chÃ­nh cá»§a PWA trong báº£n cáº­p nháº­t má»›i nháº¥t cá»§a Apple. Váº­y lÃ  gáº§n nhÆ° táº¥t cáº£ cÃ¡c platform vÃ  browser Ä‘á»u Ä‘Ã£ há»— trá»£ service worker.
- PWA giÃºp tÄƒng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng â†’ táº¡o lá»£i nhuáº­n cho nhÃ  phÃ¡t triá»ƒn á»©ng dá»¥ng. Pinterest tÄƒng **40%** thá»i gian Ä‘Æ°á»£c sá»­ dá»¥ng, doanh thu quáº£ng cÃ¡o tÄƒng **40%** vÃ  sá»± gáº¯n káº¿t cá»§a ngÆ°á»i dÃ¹ng tÄƒng **60%** khi chuyá»ƒn sang sá»­ dá»¥ng PWA viáº¿t báº±ng React, Redux vÃ  Webpack. Twitter, instagram, tinder Ä‘á»u cho ra máº¯t báº£n lite Ã¡p dá»¥ng PWA cÃ³ dung lÆ°á»£ng dÆ°á»›i 10mb hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh.

![PWA Ä‘Ã£ giÃºp Pinterest tÄƒng doanh thu nhÆ° tháº¿ nÃ o](/static/images/assets/bmZW6vLuF-wmnBqS.png)

- PWA cÃ³ thá»ƒ Ä‘Æ°á»£c cÃ i Ä‘áº·t khÃ´ng thÃ´ng qua store â†’ tiáº¿t kiá»‡n Ä‘Æ°á»£c chi phÃ­ cho app store, tuy nhiÃªn viá»‡c khÃ´ng kiáº¿m Ä‘Æ°á»£c lá»£i nhuáº­n tá»« PWA cÅ©ng cÃ³ thá»ƒ lÃ  lÃ½ do chÃ­nh khiáº¿n Apple khÃ´ng máº¥y máº·n mÃ .

![Perform cá»§a website khi sá»­ dá»¥ng service worker Ä‘Æ°á»£c cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ](/static/images/assets/HZIQXJzyKo4tH8EH.png)

- [HTTPS trá»Ÿ thÃ nh tiÃªu chuáº©n chung cho cÃ¡c websites](https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html) vÃ  service worker chá»‰ lÃ m viá»‡c vá»›i HTTPS, thÃªm ná»¯a PWA há»— trá»£ Ä‘áº§y Ä‘á»§ cÃ¡c tÃ­nh nÄƒng SEO. **58%** cÃ¡c trang web ecomerce cÃ³ Ä‘iá»ƒm Ä‘Ã¡nh giÃ¡ PWA tá»« 40-60/100 m 41% dÆ°á»›i 40 vÃ  chá»‰ khoáº£ng 1% trÃªn 60 theo káº¿t quáº£ cá»§a [Lighthouse](https://developers.google.com/web/tools/lighthouse/) (cÃ´ng cá»¥ Ä‘Ã¡nh giÃ¡ website cá»§a google chrome).

HÃ£y thá»­ tÆ°á»Ÿng tÆ°á»£ng Ä‘áº¿n viá»‡c cÃ¡c láº­p trÃ¬nh viÃªn cá»§a **vnexpress**, **dÃ¢n trÃ­** hay má»™t sá»‘ á»©ng dá»¥ng Ä‘á»c bÃ¡o khÃ¡c pháº£i váº¥t váº£ tháº¿ nÃ o Ä‘á»ƒ cÃ³ thá»ƒ maintain Ä‘Æ°á»£c cÃ¡c á»©ng dá»¥ng cá»§a mÃ¬nh trÃªn nhiá»u platforms khÃ¡c nhau, trong khi Ä‘Ã³, má»™t láº­p trÃ¬nh viÃªn cÃ³ kiáº¿n thá»©c vá» responsive design vÃ  PWA sá»­ dá»¥ng **dÆ°á»›i 1 month man** cÃ³ thá»ƒ táº¡o ra 1 á»©ng dá»¥ng Ä‘a ná»n táº£ng hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh cÃ³ Ä‘áº§y Ä‘á»§ cÃ¡c chá»©c nÄƒng cá»§a native apps.

Tuy [PWA trÃªn iOS váº«n cÃ²n bá»‹ giá»›i háº¡n nhiá»u](https://medium.com/@firt/pwas-are-coming-to-ios-11-3-cupertino-we-have-a-problem-2ff49fd7d6ea) nhÆ°ng trong tÆ°Æ¡ng lai khÃ´ng xa, cÃ³ thá»ƒ hi vá»ng ráº±ng PWA sáº½ Ä‘Æ°á»£c há»— trá»£ Ä‘áº§y Ä‘á»§ trÃªn cÃ¡c platforms vÃ  browsers.

# LÃ m sao Ä‘á»ƒ biáº¿n wep app thÃ nh PWA?

## Manifest file

Táº¡o manifest file theo hÆ°á»›ng dáº«n táº¡i trang [Add a web app manifest](https://web.dev/add-manifest/)

```json:manifest.json
{
    "name": "VNTechies Dev Blog",
    "short_name": "VNTechies",
    "start_url": ".",
    "theme_color": "#ffffff",
    "background_color": "#ffffff",
    "display": "standalone",
    "description": "Tech blog dÃ nh cho ngÆ°á»i Viá»‡t yÃªu cÃ´ng nghá»‡",
    "scope": "/",
    "icons": [
        {
            "src": "/static/favicons/android-chrome-192x192.png",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "/static/favicons/android-chrome-384x384.png",
            "sizes": "384x384",
            "type": "image/png"
        }
    ]
}
```

Manifest sáº½ config cÃ¡c thÃ´ng sá»‘ cáº§n thiáº¿t vá»›i má»™t PWA:

- name â†’ tÃªn cá»§a á»©ng dá»¥ng
- short_name â†’ tÃªn hiá»ƒn thá»‹
- start_url â†’ url cá»§a website
- icons â†’ icon cá»§a PWA trÃªn homescreen cá»§a ngÆ°á»i dÃ¹ng

Khai báº£o file `manifest.json` báº±ng tháº» tag meta, tiá»‡n thá»ƒ khai bÃ¡o thÃªm má»™t sá»‘ tháº» tag Ä‘á»ƒ web browser cÃ³ thá»ƒ nháº­n diá»‡n Ä‘Æ°á»£c PWA

```html:index.html
<link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/static/favicons/apple-touch-icon.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/static/favicons/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/static/favicons/favicon-16x16.png"
/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="qmau.me" />
<link rel="manifest" href="/manifest.json" />
<link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#fa8148" />
<link rel="shortcut icon" href="/static/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#000000" />
<meta name="msapplication-config" content="/static/favicons/browserconfig.xml" />
<meta name="theme-color" content="#ffffff" />
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff" />
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000" />
```

### Service worker

Äá»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng service worker PWA cáº§n pháº£i Ä‘Äƒng kÃ½ sw file khi load trang, add script cÃ i Ä‘áº·t sw vÃ o trong `index.html`.

```javascript:index.html
window.addEventListener('load', () => {
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker
      .register('/sw.js')
      .then(() => {
        console.log('Service worker registered!')
      })
      .catch((error) => {
        console.warn('Error registering service worker:')
        console.warn(error)
      })
  }
})
```

NhÆ° Ä‘Ã£ trÃ¬nh bÃ y á»Ÿ pháº§n trÃªn, service worker Ä‘Ã³ng vai trÃ² nhÆ° má»™t proxy Ä‘iá»u hÆ°á»›ng cho PWA. Vá»›i VNTechies Dev Blog, service worker cÃ³ nhiá»‡m vá»¥ precache tÃ i nguyÃªn Ä‘á»ƒ ngÆ°á»i dÃ¹ng váº«n cÃ³ tráº£i nghiá»‡m tá»‘t trong Ä‘iá»u kiá»‡n máº¡ng yáº¿u (hoáº·c tháº­m chÃ­ lÃ  khÃ´ng cÃ³ máº¡ng).
Má»™t sá»‘ scenario cache Ä‘Æ°á»£c trÃ¬nh bÃ y cá»¥ thá»ƒ táº¡i [offline cookbook](https://web.dev/offline-cookbook/) vÃ  [serviceworke.rs](https://serviceworke.rs/).

VNTechies Dev Blog:

- Sá»­ dá»¥ng strategy [Network first](https://developer.chrome.com/docs/workbox/modules/workbox-strategies/#network-first-network-falling-back-to-cache) vá»›i nhá»¯ng file js,css
- Sá»­ dá»¥ng strategy [Cache first](https://developer.chrome.com/docs/workbox/modules/workbox-strategies/#cache-first-cache-falling-back-to-network) vá»›i nhá»¯ng file áº£nh (png,jpg,jpeg,svg,gif,webp)

```javascript:sw.js
importScripts('https://storage.googleapis.com/workbox-cdn/releases/3.6.1/workbox-sw.js')

if (workbox) {
  workbox.setConfig({ debug: false })

  var defaultStrategy = workbox.strategies.networkFirst({
    cacheName: 'fallback',
    plugins: [
      new workbox.expiration.Plugin({
        maxEntries: 128,
        maxAgeSeconds: 7 * 24 * 60 * 60, // 1 week
        purgeOnQuotaError: true, // Opt-in to automatic cleanup
      }),
      new workbox.cacheableResponse.Plugin({
        statuses: [0, 200], // for opague requests
      }),
    ],
  })
  workbox.routing.setDefaultHandler((args) => {
    if (args.event.request.method === 'GET') {
      return defaultStrategy.handle(args) // use default strategy
    } else {
      return null
    }
  })

  workbox.routing.registerRoute(new RegExp(/.*\.(?:js|css)/g), workbox.strategies.networkFirst())

  workbox.routing.registerRoute(
    new RegExp(/.*\.(?:png|jpg|jpeg|svg|gif|webp)/g),
    workbox.strategies.cacheFirst()
  )
} else {
  console.log(`No workbox on this browser ğŸ˜¬`)
}
```

## Deploy, test

![MacOS](/static/images/assets/macos.png)

![iOS](/static/images/assets/ios.png)

![android](/static/images/assets/android.png)

![windows](/static/images/assets/windows.png)

![Lighthouse score](/static/images/assets/light-house-score.png)

VNTechies Dev Blog Ä‘áº¡t 100 Ä‘iá»ƒm performance trÃªn Lighthouse audit â¤ï¸â€ğŸ”¥

CÃ¡c báº¡n cÃ³ thá»ƒ tham kháº£o thÃªm bÃ i viáº¿t [7 tÃ­nh nÄƒng Ã­t Ä‘Æ°á»£c biáº¿t tá»›i cá»§a PWA](/blog/7-tinh-nang-cua-pwa) Ä‘á»ƒ cáº£i thiá»‡n tÃ­nh nÄƒng cá»§a web app.

# References

- [Add a web app manifest](https://web.dev/add-manifest/)
- [https://web.dev/what-are-pwas/](https://web.dev/what-are-pwas/)
- [A service worker's life](https://developer.chrome.com/docs/workbox/service-worker-lifecycle/)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse/)
- [Google-PWA](https://developers.google.com/web/progressive-web-apps/)
- [Google-service worker](https://developers.google.com/web/fundamentals/primers/service-workers/)
- [PWA-kipalog](https://kipalog.com/posts/Progressive-Web-Apps-la-gi)
- [Pinterest PWA](https://medium.com/dev-channel/a-pinterest-progressive-web-app-performance-case-study-3bd6ed2e6154)
- [Twitter lite performance](https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3)
- [PWA on iOS](https://medium.com/@firt/progressive-web-apps-on-ios-are-here-d00430dee3a7)
- [PWA libraries](https://medium.com/dev-channel/progressive-web-app-libraries-in-production-b52cad37d34)
- [PWA on all platforms](https://medium.com/@kennethrohde/progressive-web-apps-coming-to-all-chrome-platforms-80e31272e2a8)
- [Next big thing](https://medium.com/progressive-web-apps/who-still-havent-experienced-the-2-years-old-next-big-thing-for-mobile-web-978cc55f821a)
