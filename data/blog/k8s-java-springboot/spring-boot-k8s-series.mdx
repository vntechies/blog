---
title: Mở đầu chuỗi bài hướng dẫn triển khai Spring boot application với Kubernetes
date: '2020-11-11'
tags: ['api', 'rest api']
series: ['k8s-spring-boot']
draft: false
authors: ['thanhnb'] #change me
images: ['/static/images/ogps/k8s-springboot.png']
summary: 'Sample summary'
---

![](/static/images/ogps/k8s-springboot.png)

<TOCInline toc={props.toc} asDisclosure />

## 1. Giới thiệu chung

Trong chuỗi bài này, chúng ta cùng nhau tìm hiểu cách phát triển (develop) và triển khai (deploy) một ứng dụng quản lý học sinh trên K8s. Mục đích của chuỗi bài này là tìm hiểu những thành phần cơ bản của Kubernetes thông qua việc triển khai (deploy) ứng dụng trên K8s. Trong bài mở đầu này thì sẽ hướng dẫn cách cài đặt môi trường, tạo mới project và giới thiệu qua về ứng dụng mà sẽ triển khai.

## 2. Cài đặt môi trường

- Cài đặt [JDK](https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-on-ubuntu-22-04).
- Cài đặt [Docker](https://docs.docker.com/engine/install/ubuntu/).
- Cài đặt [MicroK8s](https://dev.to/urlichsanais/getting-started-with-kubernetes-kubectl-and-microk8s-on-ubuntu-pko).

## 3. Setup Spring boot application

Ứng dụng quản lý học sinh viết bằng Spring Boot đơn giản gồm 2 API: Tạo mới học sinh, lấy danh sách học sinh. Bạn có thể tham khảo source code [ở đây](https://github.com/nbthanh98/k8s-springboot-series).

Truy cập [Spring Initializr](https://start.spring.io/) để tạo mới một Spring Boot project và thêm một số thông tin của project như:

- Thông tin project: tên: `k8s-springboot-series`, build tool: `Maven`, Spring Boot: `3.0.0`, java version: `11`.
- Thông tin dependencies: `Spring Web`, `Spring Boot DevTools`, `Lombok`, `MySQL Driver`, `Spring Data JPA`.

![](/static/images/assets/tao-moi-project-spring.png)

Class `Student` dưới đây định nghĩa các trường thông tin về Student:

```java
@Table(name = "students")
@Entity
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    private String code;
    private String name;
    private Integer age;
}
```

Class `StudentController` dưới đây định nghĩa các API như:

- POST `/api/students/create`: tạo mới Student.
- GET `/api/students`: lấy danh sách Student.

```java
@RestController
@RequestMapping(value = "/api/students")
public class StudentController {

  private final IStudentService iStudentService;

    public StudentController(IStudentService iStudentService) {
        this.iStudentService = iStudentService;
    }

    @PostMapping(value = "/create")
    public ResponseEntity<CreateStudentResponse> createStudent(@RequestBody CreateStudentRequest request) {
        return new ResponseEntity<>(iStudentService.createStudent(request), HttpStatus.CREATED);
    }

    @GetMapping
    public ResponseEntity<List<Student>> getAll() {
        return new ResponseEntity<>(iStudentService.getAll(), HttpStatus.OK);
    }
  }
```

Class `StudentServiceImpl` định nghĩa các logic tạo mới và lấy danh sách Student:

```java
@Service
public class StudentServiceImpl implements IStudentService {

    private final IStudentRepository iStudentRepository;

    public StudentServiceImpl(IStudentRepository iStudentRepository) {
        this.iStudentRepository = iStudentRepository;
    }

    @Override
    public CreateStudentResponse createStudent(CreateStudentRequest createStudentRequest) {
        final int min = 1;
        final int max = 999999;
        Random rand = new Random();
        int studentCodeNumber;
        boolean isExistStudentCode;
        String studentCodeStr;
        do {
            studentCodeNumber = rand.nextInt((max - min) + 1) + min;
            studentCodeStr = formatStudentCode(String.valueOf(studentCodeNumber));
            Student student = iStudentRepository.findByCode(studentCodeStr);
            isExistStudentCode = !Objects.isNull(student);
        } while (isExistStudentCode);

        Student student = new Student();
        student.setName(createStudentRequest.getName());
        student.setAge(createStudentRequest.getAge());
        student.setCode(studentCodeStr);
        return new ModelMapper().map(iStudentRepository.save(student), CreateStudentResponse.class);
    }

    private String formatStudentCode(String shopCode) {
        if (shopCode.length() == 6) {
            return shopCode;
        }
        StringBuilder shopCodeBuilder = new StringBuilder(shopCode);
        while (shopCodeBuilder.length() < 6) {
            shopCodeBuilder.insert(0, "0");
        }
        shopCode = shopCodeBuilder.toString();
        return shopCode;
    }


    @Override
    public List<Student> getAll() {
        return iStudentRepository.findAll();
    }
}
```

## 4. Tóm lại

Trong bài mở đầu chuỗi series về spring boot và kubernetes này đã giới thiệu về mục tiêu của series, các bước chuẩn bị về môi trường cũng như giới thiệu qua về spring boot application mà sẽ sử dụng. Ở bài tiếp theo thì chúng ta sẽ đi tìm hiểu cách đóng gói spring boot container với `Pod` trong Kubernetes.
